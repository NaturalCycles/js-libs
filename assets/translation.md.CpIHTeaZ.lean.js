var W=Object.defineProperty;var Y=(a,e,t)=>e in a?W(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var c=(a,e,t)=>Y(a,typeof e!="symbol"?e+"":e,t);import{E as _,S as T}from"./chunks/types.C-9dMxxX.js";import{i as D}from"./chunks/env.BUzbqU-4.js";import{a as z,b as J}from"./chunks/assert.BXV_d8k1.js";import{T as j,a as G,H as S,U as K,b as L,c as Q,d as X,e as Z,f as ee,_ as te}from"./chunks/stringify.D3iTrnUY.js";import{a as se,b as x,c as P,d as B,e as C,f as O,g as re}from"./chunks/object.util.CbWrJl9r.js";import{d as ae,p as $,v as ie,o as b,c as w,a as F,F as ne,B as oe,t as v,h as N,C as le,j as M,E as I,ae as ce}from"./chunks/framework.BxjyvXIc.js";import"./chunks/is.util.BDVbkSgX.js";async function he(a=0,e){return await new Promise((t,s)=>setTimeout(e instanceof Error?s:t,a,e))}class ue{constructor(e){this.fetcher=e}async load(e){return await this.fetcher.get(`${e}.json`)}}var k=(a=>(a.THROW_IMMEDIATELY="THROW_IMMEDIATELY",a.THROW_AGGREGATED="THROW_AGGREGATED",a.SUPPRESS="SUPPRESS",a))(k||{});async function de(a,e,t={}){const s=[...a],r=s.length;if(r===0)return[];const{concurrency:n=1/0,errorMode:i=k.THROW_IMMEDIATELY,logger:l=console}=t;if(n===1)return await fe(s,e,i,l);if(s.length<=n)return await pe(s,e,i,l);const h=[],u=[];let o=!1,p=0,m=0;return await new Promise((E,f)=>{const d=()=>{if(o)return;const R=s[m],A=m++;if(m>r){if(p===0){o=!0;const y=h.filter(U=>U!==T);u.length?f(new AggregateError(u,`pMap resulted in ${u.length} error(s)`)):E(y)}return}p++,Promise.resolve(R).then(async y=>await e(y,A)).then(y=>{if(y===_)return o=!0,E(h.filter(U=>U!==T));h[A]=y,p--,d()},y=>{i===k.THROW_IMMEDIATELY?(o=!0,f(y)):(i===k.THROW_AGGREGATED?u.push(y):l==null||l.error(y),p--,d())})};for(let R=0;R<n&&(d(),!o);R++);})}async function fe(a,e,t,s){let r=0;const n=[],i=[];for(const l of a)try{const h=await e(l,r++);if(h===_)break;h!==T&&n.push(h)}catch(h){if(t===k.THROW_IMMEDIATELY)throw h;t===k.THROW_AGGREGATED?i.push(h):s==null||s.error(h)}if(i.length)throw new AggregateError(i,`pMap resulted in ${i.length} error(s)`);return n}async function pe(a,e,t,s){if(t===k.THROW_IMMEDIATELY)return(await Promise.all(a.map((i,l)=>e(i,l)))).filter(i=>i!==T&&i!==_);const r=[],n=[];for(const i of await Promise.allSettled(a.map((l,h)=>e(l,h))))if(i.status==="fulfilled"){if(i.value===_)break;i.value!==T&&r.push(i.value)}else t===k.THROW_AGGREGATED?n.push(i.reason):s==null||s.error(i.reason);if(n.length)throw new AggregateError(n,`pMap resulted in ${n.length} error(s)`);return r}const ye=a=>(console.warn(`[tr] missing: ${a}`),`[${a}]`);class me{constructor(e,t={}){c(this,"cfg");c(this,"locales");c(this,"currentLocale");this.cfg={...e,missingTranslationHandler:ye},this.locales={...t},this.currentLocale=e.currentLocale||e.defaultLocale}setLocale(e,t){this.locales[e]=t}getLocale(e){return this.locales[e]}async loadLocale(e){const t=Array.isArray(e)?e:[e];await de(t,async s=>{this.locales[s]||(this.locales[s]=await this.cfg.translationLoader.load(s))})}translate(e,t){return this.translateIfExists(e,t)||this.cfg.missingTranslationHandler(e,t)}translateIfExists(e,t){var s,r;return((s=this.locales[this.currentLocale])==null?void 0:s[e])||((r=this.locales[this.cfg.defaultLocale])==null?void 0:r[e])}}function H(a,e=Date.now()){return V(e-a)}function V(a){if(a<1e3)return`${Math.round(a)} ms`;if(a<1e4)return`${(a/1e3).toFixed(2)} sec`;const e=Math.floor(a/1e3)%60,t=Math.floor(a/(60*1e3))%60,s=Math.floor(a/(3600*1e3));return s===0?t===0?`${e} sec`:`${t}m${e}s`:s<24?`${s}h${t}m`:s<48?`${Math.round(s+t/60)}h`:`${Math.floor(s/24)} days`}function ge(a,e){if(typeof a!="string")return null;try{return new URL(a,e||void 0)}catch{return null}}function Ee(a,e,t){return a<=e?e:a>=t?t:a}async function ke(a,e){if(!e.timeout)return await a();const{timeout:t,name:s=a.name||"pTimeout function",onTimeout:r}=e,n=e.fakeError||new Error("TimeoutError");return await new Promise(async(i,l)=>{const h=setTimeout(()=>{const u=new j(`"${s}" timed out after ${t} ms`,e.errorData);if(u.stack=n.stack.replace("Error: TimeoutError","TimeoutError: "+u.message),r){try{i(r(u))}catch(o){o.stack=n.stack.replace("Error: TimeoutError",o.name+": "+o.message),l(G(o,e.errorData))}return}l(u)},t);try{i(await a())}catch(u){l(u)}finally{clearTimeout(h)}})}const be=["GET","POST","PUT","PATCH","DELETE","HEAD"],g=class g{constructor(e={}){c(this,"cfg");c(this,"get");c(this,"post");c(this,"put");c(this,"patch");c(this,"delete");c(this,"getText");c(this,"postText");c(this,"putText");c(this,"patchText");c(this,"deleteText");c(this,"getVoid");c(this,"postVoid");c(this,"putVoid");c(this,"patchVoid");c(this,"deleteVoid");c(this,"headVoid");if(typeof globalThis.fetch!="function")throw new TypeError("globalThis.fetch is not available");this.cfg=this.normalizeCfg(e);for(const t of be){const s=t.toLowerCase();if(this[`${s}Void`]=async(r,n)=>await this.fetch({url:r,method:t,responseType:"void",...n}),t==="HEAD")return;this[`${s}Text`]=async(r,n)=>await this.fetch({url:r,method:t,responseType:"text",...n}),this[s]=async(r,n)=>await this.fetch({url:r,method:t,responseType:"json",...n})}}onBeforeRequest(e){var t;return((t=this.cfg.hooks).beforeRequest||(t.beforeRequest=[])).push(e),this}onAfterResponse(e){var t;return((t=this.cfg.hooks).afterResponse||(t.afterResponse=[])).push(e),this}onBeforeRetry(e){var t;return((t=this.cfg.hooks).beforeRetry||(t.beforeRetry=[])).push(e),this}onError(e){var t;return((t=this.cfg.hooks).onError||(t.onError=[])).push(e),this}static create(e={}){return new g(e)}async queryGraphQL(e){e.method||(e.method=this.cfg.init.method);const t=se({query:e.query,variables:e.variables});e.method==="GET"&&e.query.length>1900&&(e.method="POST"),e.method==="GET"?e.searchParams={...e.searchParams,...t}:e.json=t;const s=await this.doFetch(e);if(s.err)throw s.err;if(s.body.errors){const n=s.body.errors[0];throw new S(n.message,{...t,errors:s.body.errors,response:s.fetchResponse,responseStatusCode:s.statusCode,requestUrl:s.req.fullUrl,requestBaseUrl:this.cfg.baseUrl,requestMethod:s.req.init.method,requestSignature:s.signature,requestName:s.req.requestName,fetcherName:this.cfg.name,requestDuration:Date.now()-s.req.started})}const{data:r}=s.body;return e.unwrapObject?r[e.unwrapObject]:r}async getReadableStream(e,t){return await this.fetch({url:e,responseType:"readableStream",...t})}async fetch(e){const t=await this.doFetch(e);if(t.err)throw t.err;return t.body}async expectError(e){const t=await this.doFetch(e);if(!t.err)throw new K("Fetch was expected to error");return z(t.err,S),t.err}async tryFetch(e){const t=await this.doFetch(e);return t.err?(J(t.err,S),[t.err,null]):[null,t.body]}async doFetch(e){var p,m,E;const t=this.normalizeOptions(e),{logger:s}=this.cfg,{timeoutSeconds:r,init:{method:n}}=t;for(const f of this.cfg.hooks.beforeRequest||[])await f(t);const l=t.fullUrl.includes("://")?new URL(t.fullUrl):void 0,h=l?this.getShortUrl(l):t.fullUrl,u=[n,h].join(" "),o={req:t,retryStatus:{retryAttempt:0,retryStopped:!1,retryTimeout:t.retry.timeout},signature:u};for(;!o.retryStatus.retryStopped;){t.started=Date.now();let f;if(r){const d=new AbortController;t.init.signal=d.signal,f=setTimeout(()=>{d.abort(new j(`request timed out after ${r} sec`))},r*1e3)}if(t.logRequest){const{retryAttempt:d}=o.retryStatus;s.log([" >>",u,d&&`try#${d+1}/${t.retry.count+1}`].filter(Boolean).join(" ")),t.logRequestBody&&t.init.body&&s.log(t.init.body)}try{o.fetchResponse=await(this.cfg.overrideFetchFn||g.callNativeFetch)(t.fullUrl,t.init,this.cfg.fetchFn),o.ok=o.fetchResponse.ok,o.err=void 0}catch(d){o.err=L(d),o.ok=!1,o.fetchResponse=void 0}finally{clearTimeout(f)}if(o.statusFamily=this.getStatusFamily(o),o.statusCode=(p=o.fetchResponse)==null?void 0:p.status,(m=o.fetchResponse)!=null&&m.ok||!t.throwHttpErrors)try{await ke(async()=>await this.onOkResponse(o),{timeout:r*1e3||Number.POSITIVE_INFINITY,name:"Fetcher.downloadBody"})}catch(d){o.err=L(d),o.ok=!1,await this.onNotOkResponse(o)}else await this.onNotOkResponse(o)}if(o.err){G(o.err,t.errorData),(E=t.onError)==null||E.call(t,o.err);for(const f of this.cfg.hooks.onError||[])await f(o.err)}for(const f of this.cfg.hooks.afterResponse||[])await f(o);return o}async onOkResponse(e){const{req:t}=e,{responseType:s}=e.req;if(s==="json")if(e.fetchResponse.body){const r=await e.fetchResponse.text();r?(e.body=r,e.body=Q(r,t.jsonReviver)):e.body={}}else e.body={};else if(s==="text")e.body=e.fetchResponse.body?await e.fetchResponse.text():"";else if(s==="arrayBuffer")e.body=e.fetchResponse.body?await e.fetchResponse.arrayBuffer():{};else if(s==="blob")e.body=e.fetchResponse.body?await e.fetchResponse.blob():{};else if(s==="readableStream"&&(e.body=e.fetchResponse.body,e.body===null))throw new Error("fetchResponse.body is null");if(e.retryStatus.retryStopped=!0,(!e.err||!t.throwHttpErrors)&&t.logResponse){const{retryAttempt:r}=e.retryStatus,{logger:n}=this.cfg;n.log([" <<",e.fetchResponse.status,e.signature,r&&`try#${r+1}/${t.retry.count+1}`,H(e.req.started)].filter(Boolean).join(" ")),t.logResponseBody&&e.body!==void 0&&n.log(e.body)}}static async callNativeFetch(e,t,s){return await(s||globalThis.fetch)(e,t)}async onNotOkResponse(e){var n;let t;if(!e.body&&e.fetchResponse)try{e.body=X(await e.fetchResponse.text())}catch{}e.err?t=Z(e.err):e.body?t=ee(e.body):t={name:"Error",message:"Fetch failed",data:{}};let s=((n=e.fetchResponse)==null?void 0:n.status)||0;e.statusFamily===2&&(e.statusFamily=void 0,e.statusCode=void 0,s=0);const r=[e.statusCode,e.signature].filter(Boolean).join(" ");e.err=new S(r,x({response:e.fetchResponse,responseStatusCode:s,requestUrl:e.req.fullUrl,requestBaseUrl:this.cfg.baseUrl||void 0,requestMethod:e.req.init.method,requestSignature:e.signature,requestName:e.req.requestName,fetcherName:this.cfg.name,requestDuration:Date.now()-e.req.started}),{cause:t}),await this.processRetry(e)}async processRetry(e){var l;const{retryStatus:t}=e;this.shouldRetry(e)||(t.retryStopped=!0);for(const h of this.cfg.hooks.beforeRetry||[])await h(e);const{count:s,timeoutMultiplier:r,timeoutMax:n}=e.req.retry;if(t.retryAttempt>=s&&(t.retryStopped=!0),e.err&&(!t.retryStopped||e.req.logResponse)&&this.cfg.logger.error([" <<",((l=e.fetchResponse)==null?void 0:l.status)||0,e.signature,s&&(t.retryAttempt||!t.retryStopped)&&`try#${t.retryAttempt+1}/${s+1}`,H(e.req.started)].filter(Boolean).join(" ")+`
`,te(e.err.cause||e.err)),t.retryStopped)return;t.retryAttempt++,t.retryTimeout=Ee(t.retryTimeout*r,0,n);const i=this.getRetryTimeout(e);e.req.debug&&this.cfg.logger.log(` .. ${e.signature} waiting ${V(i)}`),await he(i)}getRetryTimeout(e){let t=0;if(e.fetchResponse&&[429,503].includes(e.fetchResponse.status)){const s=e.fetchResponse.headers.get("retry-after")??e.fetchResponse.headers.get("x-ratelimit-reset");if(s){if(Number(s))t=Number(s)*1e3;else{const r=new Date(s);Number.isNaN(r)||(t=Number(r)-Date.now())}this.cfg.logger.log(`retry-after: ${s}`),t||this.cfg.logger.warn("retry-after could not be parsed")}}if(!t){const s=Math.random()*500;t=e.retryStatus.retryTimeout+s}return t}shouldRetry(e){var u,o,p,m,E;const{retryPost:t,retry3xx:s,retry4xx:r,retry5xx:n}=e.req,{method:i}=e.req.init;if(i==="POST"&&!t)return!1;const{statusFamily:l}=e,h=((u=e.fetchResponse)==null?void 0:u.status)||0;return l===5&&!n?!1:[408,429].includes(h)?!0:!(l===4&&!r||l===3&&!s||(E=(m=(p=(o=e.err)==null?void 0:o.cause)==null?void 0:p.cause)==null?void 0:m.message)!=null&&E.includes("unexpected redirect"))}getStatusFamily(e){var s;const t=(s=e.fetchResponse)==null?void 0:s.status;if(t){if(t>=500)return 5;if(t>=400)return 4;if(t>=300)return 3;if(t>=200)return 2;if(t>=100)return 1}}getShortUrl(e){const{baseUrl:t}=this.cfg;e.password&&(e=new URL(e.toString()),e.password="[redacted]");let s=e.toString();return this.cfg.logWithSearchParams||(s=s.split("?")[0]),!this.cfg.logWithBaseUrl&&t&&s.startsWith(t)&&(s=s.slice(t.length)),s}normalizeCfg(e){var n;const{debug:t=!1,logger:s=console}=e;(n=e.baseUrl)!=null&&n.endsWith("/")&&(s.warn(`Fetcher: baseUrl should not end with slash: ${e.baseUrl}`),e.baseUrl=e.baseUrl.slice(0,e.baseUrl.length-1));const r=P({baseUrl:"",name:this.getFetcherName(e),inputUrl:"",responseType:"json",searchParams:{},timeoutSeconds:30,retryPost:!1,retry3xx:!1,retry4xx:!1,retry5xx:!0,logger:s,debug:t,logRequest:t,logRequestBody:t,logResponse:t,logResponseBody:t,logWithBaseUrl:D(),logWithSearchParams:!0,retry:{...Re},init:{method:e.method||"GET",headers:x({"user-agent":g.userAgent,...e.headers}),credentials:e.credentials,redirect:e.redirect,dispatcher:e.dispatcher},hooks:{},throwHttpErrors:!0,errorData:{}},B(e,["method","credentials","headers","redirect","logger","name"]));return r.init.headers=C(r.init.headers,i=>i.toLowerCase()),r}getFetcherName(e){let{name:t}=e;if(!t&&e.baseUrl){const s=ge(e.baseUrl);s&&(t=s.hostname)}return t}normalizeOptions(e){var n;const t={...re(this.cfg,["timeoutSeconds","retryPost","retry4xx","retry5xx","responseType","jsonReviver","logRequest","logRequestBody","logResponse","logResponseBody","debug","throwHttpErrors","errorData"]),started:Date.now(),...B(e,["method","headers","credentials"]),inputUrl:e.url||"",fullUrl:e.url||"",retry:{...this.cfg.retry,...O(e.retry||{})},init:P({...this.cfg.init,headers:{...this.cfg.init.headers,"user-agent":g.userAgent},method:e.method||this.cfg.init.method,credentials:e.credentials||this.cfg.init.credentials,redirect:e.redirect||this.cfg.init.redirect||"follow"},{headers:C(e.headers||{},i=>i.toLowerCase())})};x(t.init.headers,{mutate:!0});const s=e.baseUrl||this.cfg.baseUrl;if(s){let{inputUrl:i}=t;i.startsWith("/")&&(this.cfg.logger.warn("Fetcher: url should not start with / when baseUrl is specified"),i=i.slice(1)),t.fullUrl=`${s}/${i}`}const r=O({...this.cfg.searchParams,...e.searchParams});if(Object.keys(r).length){const i=new URLSearchParams(r).toString();t.fullUrl+=(t.fullUrl.includes("?")?"&":"?")+i}return e.json!==void 0?(t.init.body=JSON.stringify(e.json),t.init.headers["content-type"]="application/json"):e.text!==void 0?(t.init.body=e.text,t.init.headers["content-type"]="text/plain"):e.form?e.form instanceof URLSearchParams||e.form instanceof FormData?t.init.body=e.form:(t.init.body=new URLSearchParams(e.form),t.init.headers["content-type"]="application/x-www-form-urlencoded"):e.body!==void 0&&(t.init.body=e.body),(n=t.init.headers).accept||(n.accept=Te[t.responseType]),t}};c(g,"VERSION",3),c(g,"userAgent",D()?`fetcher/${g.VERSION}`:void 0);let q=g;function we(a={}){return q.create(a)}const Te={text:"text/plain",json:"application/json",void:"*/*",readableStream:"application/octet-stream",arrayBuffer:"application/octet-stream",blob:"application/octet-stream"},Re={count:2,timeout:1e3,timeoutMax:3e4,timeoutMultiplier:2},Se={class:"app-content"},ve={key:0},_e={key:1},Fe=["disabled","onClick"],Ue=ae({__name:"TranslationDemo",setup(a){const e=$(new me({defaultLocale:"en",currentLocale:"en",supportedLocales:["en","ru"],translationLoader:new ue(we({baseUrl:"lang"}))})),t=$(!0),s=N(()=>e.value.translate("key1")),r=N(()=>e.value.translate("key2"));return ie(async()=>{await e.value.loadLocale(["en","ru"]),t.value=!1}),(n,i)=>(b(),w("div",Se,[t.value?(b(),w("div",ve,"Loading...")):(b(),w("pre",_e,[i[0]||(i[0]=F("translationService.currentLocale == ",-1)),(b(!0),w(ne,null,oe(e.value.cfg.supportedLocales,l=>(b(),w("button",{disabled:e.value.currentLocale===l,onClick:h=>e.value.currentLocale=l},v(l),9,Fe))),256)),F(`
key1: "`+v(s.value)+`"
key2: "`+v(r.value)+`"

translationService.locales: `+v(e.value.locales)+`
`,1)]))]))}}),xe={id:"translationservice",tabindex:"-1"},Ne=JSON.parse('{"title":"TranslationService","description":"","frontmatter":{},"headers":[],"relativePath":"translation.md","filePath":"translation.md"}'),qe={name:"translation.md"},Me=Object.assign(qe,{setup(a){return(e,t)=>{const s=le("Badge");return b(),w("div",null,[M("h1",xe,[t[0]||(t[0]=F("TranslationService ",-1)),I(s,{text:"experimental",type:"warning"}),t[1]||(t[1]=F()),t[2]||(t[2]=M("a",{class:"header-anchor",href:"#translationservice","aria-label":'Permalink to "TranslationService <Badge text="experimental" type="warning"/>"'},"â€‹",-1))]),t[3]||(t[3]=ce("",2)),I(Ue)])}}});export{Ne as __pageData,Me as default};
