import { expect, test } from 'vitest'
import { _gb, _hb, _hc, _kb, _mb } from './size.util.js'

test('_hb', () => {
  expect(_hb()).toBe('0 byte(s)')
  expect(_hb(0)).toBe('0 byte(s)')
  expect(_kb(1000)).toBe(1)
  expect(_mb(1024 ** 2)).toBe(1)
  expect(_gb(1024 ** 3)).toBe(1)
})

test('_hb log', () => {
  const map = new Map<number, string>()
  for (let n = 2; n < 10 ** 15; n *= 1.3) {
    map.set(Math.round(n), _hb(n))
  }

  expect(map).toMatchInlineSnapshot(`
    Map {
      2 => "2 byte(s)",
      3 => "3 byte(s)",
      4 => "4 byte(s)",
      6 => "6 byte(s)",
      7 => "7 byte(s)",
      10 => "10 byte(s)",
      13 => "13 byte(s)",
      16 => "16 byte(s)",
      21 => "21 byte(s)",
      28 => "28 byte(s)",
      36 => "36 byte(s)",
      47 => "47 byte(s)",
      61 => "61 byte(s)",
      79 => "79 byte(s)",
      102 => "0.10 Kb",
      133 => "0.13 Kb",
      173 => "0.17 Kb",
      225 => "0.22 Kb",
      292 => "0.29 Kb",
      380 => "0.37 Kb",
      494 => "0.48 Kb",
      642 => "0.63 Kb",
      835 => "0.82 Kb",
      1086 => "1.06 Kb",
      1411 => "1.38 Kb",
      1835 => "1.79 Kb",
      2385 => "2.33 Kb",
      3101 => "3.03 Kb",
      4031 => "3.94 Kb",
      5240 => "5.12 Kb",
      6812 => "6.65 Kb",
      8856 => "8.65 Kb",
      11512 => "11.2 Kb",
      14966 => "14.6 Kb",
      19456 => "19.0 Kb",
      25292 => "24.7 Kb",
      32880 => "32.1 Kb",
      42744 => "41.7 Kb",
      55567 => "54.3 Kb",
      72238 => "70.5 Kb",
      93909 => "91.7 Kb",
      122082 => "119 Kb",
      158706 => "155 Kb",
      206318 => "201 Kb",
      268214 => "262 Kb",
      348678 => "341 Kb",
      453281 => "443 Kb",
      589265 => "575 Kb",
      766045 => "748 Kb",
      995858 => "973 Kb",
      1294616 => "1.23 Mb",
      1683001 => "1.61 Mb",
      2187901 => "2.09 Mb",
      2844271 => "2.71 Mb",
      3697553 => "3.53 Mb",
      4806819 => "4.58 Mb",
      6248864 => "5.96 Mb",
      8123523 => "7.75 Mb",
      10560580 => "10.1 Mb",
      13728754 => "13.1 Mb",
      17847381 => "17.0 Mb",
      23201595 => "22.1 Mb",
      30162073 => "28.8 Mb",
      39210695 => "37.4 Mb",
      50973904 => "48.6 Mb",
      66266075 => "63.2 Mb",
      86145898 => "82.2 Mb",
      111989667 => "107 Mb",
      145586567 => "139 Mb",
      189262537 => "180 Mb",
      246041298 => "235 Mb",
      319853687 => "305 Mb",
      415809794 => "397 Mb",
      540552732 => "516 Mb",
      702718551 => "670 Mb",
      913534116 => "871 Mb",
      1187594351 => "1.11 Gb",
      1543872657 => "1.44 Gb",
      2007034454 => "1.87 Gb",
      2609144790 => "2.43 Gb",
      3391888227 => "3.16 Gb",
      4409454695 => "4.11 Gb",
      5732291104 => "5.34 Gb",
      7451978435 => "6.94 Gb",
      9687571966 => "9.02 Gb",
      12593843555 => "11.7 Gb",
      16371996622 => "15.2 Gb",
      21283595608 => "19.8 Gb",
      27668674291 => "25.8 Gb",
      35969276578 => "33.5 Gb",
      46760059551 => "43.5 Gb",
      60788077417 => "56.6 Gb",
      79024500642 => "73.6 Gb",
      102731850834 => "96 Gb",
      133551406084 => "124 Gb",
      173616827910 => "162 Gb",
      225701876283 => "210 Gb",
      293412439168 => "273 Gb",
      381436170918 => "355 Gb",
      495867022193 => "462 Gb",
      644627128851 => "600 Gb",
      838015267507 => "780 Gb",
      1089419847758 => "0.99 Tb",
      1416245802086 => "1.29 Tb",
      1841119542712 => "1.67 Tb",
      2393455405525 => "2.18 Tb",
      3111492027183 => "2.83 Tb",
      4044939635338 => "3.68 Tb",
      5258421525939 => "4.78 Tb",
      6835947983721 => "6.22 Tb",
      8886732378837 => "8.08 Tb",
      11552752092488 => "10.5 Tb",
      15018577720235 => "13.7 Tb",
      19524151036305 => "17.8 Tb",
      25381396347197 => "23.1 Tb",
      32995815251356 => "30.0 Tb",
      42894559826763 => "39.0 Tb",
      55762927774791 => "50.7 Tb",
      72491806107229 => "65.9 Tb",
      94239347939397 => "85.7 Tb",
      122511152321216 => "111 Tb",
      159264498017581 => "145 Tb",
      207043847422856 => "188 Tb",
      269157001649712 => "245 Tb",
      349904102144626 => "318 Tb",
      454875332788014 => "414 Tb",
      591337932624418 => "538 Tb",
      768739312411744 => "699 Tb",
      999361106135267 => "909 Tb",
    }
  `)
})

test('_hc log', () => {
  const map = new Map<number, string>()
  for (let n = 2; n < 10 ** 15; n *= 1.3) {
    map.set(Math.round(n), _hc(n))
  }

  expect(map).toMatchInlineSnapshot(`
    Map {
      2 => "2",
      3 => "3",
      4 => "4",
      6 => "6",
      7 => "7",
      10 => "10",
      13 => "13",
      16 => "16",
      21 => "21",
      28 => "28",
      36 => "36",
      47 => "47",
      61 => "61",
      79 => "79",
      102 => "102",
      133 => "133",
      173 => "173",
      225 => "225",
      292 => "292",
      380 => "380",
      494 => "494",
      642 => "642",
      835 => "835",
      1086 => "1.09 K",
      1411 => "1.41 K",
      1835 => "1.83 K",
      2385 => "2.39 K",
      3101 => "3.10 K",
      4031 => "4.03 K",
      5240 => "5.24 K",
      6812 => "6.81 K",
      8856 => "8.86 K",
      11512 => "11.5 K",
      14966 => "15.0 K",
      19456 => "19.5 K",
      25292 => "25.3 K",
      32880 => "32.9 K",
      42744 => "42.7 K",
      55567 => "55.6 K",
      72238 => "72.2 K",
      93909 => "93.9 K",
      122082 => "122 K",
      158706 => "159 K",
      206318 => "206 K",
      268214 => "268 K",
      348678 => "349 K",
      453281 => "453 K",
      589265 => "589 K",
      766045 => "766 K",
      995858 => "996 K",
      1294616 => "1.29 M",
      1683001 => "1.68 M",
      2187901 => "2.19 M",
      2844271 => "2.84 M",
      3697553 => "3.70 M",
      4806819 => "4.81 M",
      6248864 => "6.25 M",
      8123523 => "8.12 M",
      10560580 => "10.6 M",
      13728754 => "13.7 M",
      17847381 => "17.8 M",
      23201595 => "23.2 M",
      30162073 => "30.2 M",
      39210695 => "39.2 M",
      50973904 => "51.0 M",
      66266075 => "66.3 M",
      86145898 => "86.1 M",
      111989667 => "112 M",
      145586567 => "146 M",
      189262537 => "189 M",
      246041298 => "246 M",
      319853687 => "320 M",
      415809794 => "416 M",
      540552732 => "541 M",
      702718551 => "703 M",
      913534116 => "914 M",
      1187594351 => "1.19 B",
      1543872657 => "1.54 B",
      2007034454 => "2.01 B",
      2609144790 => "2.61 B",
      3391888227 => "3.39 B",
      4409454695 => "4.41 B",
      5732291104 => "5.73 B",
      7451978435 => "7.45 B",
      9687571966 => "9.69 B",
      12593843555 => "12.6 B",
      16371996622 => "16.4 B",
      21283595608 => "21.3 B",
      27668674291 => "27.7 B",
      35969276578 => "36.0 B",
      46760059551 => "46.8 B",
      60788077417 => "60.8 B",
      79024500642 => "79.0 B",
      102731850834 => "103 B",
      133551406084 => "134 B",
      173616827910 => "174 B",
      225701876283 => "226 B",
      293412439168 => "293 B",
      381436170918 => "381 B",
      495867022193 => "496 B",
      644627128851 => "645 B",
      838015267507 => "838 B",
      1089419847758 => "1.09 T",
      1416245802086 => "1.42 T",
      1841119542712 => "1.84 T",
      2393455405525 => "2.39 T",
      3111492027183 => "3.11 T",
      4044939635338 => "4.04 T",
      5258421525939 => "5.26 T",
      6835947983721 => "6.84 T",
      8886732378837 => "8.89 T",
      11552752092488 => "11.6 T",
      15018577720235 => "15.0 T",
      19524151036305 => "19.5 T",
      25381396347197 => "25.4 T",
      32995815251356 => "33.0 T",
      42894559826763 => "42.9 T",
      55762927774791 => "55.8 T",
      72491806107229 => "72.5 T",
      94239347939397 => "94.2 T",
      122511152321216 => "123 T",
      159264498017581 => "159 T",
      207043847422856 => "207 T",
      269157001649712 => "269 T",
      349904102144626 => "350 T",
      454875332788014 => "455 T",
      591337932624418 => "591 T",
      768739312411744 => "769 T",
      999361106135267 => "999 T",
    }
  `)

  expect([0, 0.1, 0.01, 0.15, 0.001, 0.00045, 0.00000000123].map(_hc)).toMatchInlineSnapshot(`
    [
      "0",
      "0",
      "0",
      "0",
      "0",
      "0",
      "0",
    ]
  `)
})
